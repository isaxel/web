<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<f:view contentType="text/html;charset=UTF-8" encoding="UTF-8">

    <h:head>
        <title>Лаба3</title>

        <meta name="msapplication-TileColor" content="#da532c"/>
        <meta name="theme-color" content="#ffffff"/>

        <link rel="stylesheet" href="resources/css/style.css"/>
        <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"/>

        <script type="text/javascript" src="#{request.contextPath}/jakarta.faces.resource/jquery/jquery.js.xhtml?ln=primefaces&amp;v=14.0.5"></script>
        <script type="text/javascript" src="#{request.contextPath}/jakarta.faces.resource/jquery/jquery-plugins.js.xhtml?ln=primefaces&amp;v=14.0.5"></script>
        <script type="text/javascript" src="#{request.contextPath}/jakarta.faces.resource/core.js.xhtml?ln=primefaces&amp;v=14.0.5"></script>
        <script type="text/javascript" src="#{request.contextPath}/jakarta.faces.resource/components.js.xhtml?ln=primefaces&amp;v=14.0.5"></script>

        <h:outputScript library="js" name="script.js"/>
    </h:head>
    <h:body>

        <div class="content">
            <div class="results-content">
                <div style="padding: 1rem">
                    <h:button type="button"
                              class="round confirm-colors material-icons"
                              outcome="toIndex"
                              value="arrow_back_ios_new"/>
                    <div id="click_catcher">
                        <ui:include src="resources/assets/graph.svg"/>
                    </div>
                    <h:form id="main-form">
                        <div class="form-inputs">
                            <div>
                                <p>Выберите X:</p>
                                <div>
                                    <p:selectOneMenu value="#{beanCalculator.x}"
                                                     styleClass="text-input invert-colors">
                                        <f:selectItem itemLabel="-2" itemValue="-2"/>
                                        <f:selectItem itemLabel="-1.5" itemValue="-1.5"/>
                                        <f:selectItem itemLabel="-1" itemValue="-1"/>
                                        <f:selectItem itemLabel="-0.5" itemValue="-0.5"/>
                                        <f:selectItem itemLabel="0" itemValue="0"/>
                                        <f:selectItem itemLabel="0.5" itemValue="0.5"/>
                                        <f:selectItem itemLabel="1" itemValue="1"/>
                                        <f:validateRequired/>
                                    </p:selectOneMenu>
                                </div>
                            </div>

                            <div>
                                <p>Введите Y (-5 ... 5):</p>
                                <div>
                                    <h:inputText class="green-input"
                                                 value="#{beanCalculator.y}">
                                        <f:validateRequired/>
                                        <f:validateDoubleRange minimum="-5" maximum="5"/>
                                    </h:inputText>
                                </div>
                            </div>
                            <div>
                                <p>Введите R (1 ... 3):</p>
                                <p:spinner id="rSpinner"
                                           value="#{beanCalculator.r}"
                                           min="1"
                                           max="3"
                                           stepFactor="0.5"
                                           styleClass="spinner text-input invert-colors"
                                           onchange="handleRChange()">
                                    <f:validateRequired/>
                                    <f:validateDoubleRange minimum="1" maximum="3"/>
                                </p:spinner>
                            </div>

                            <div class="form-buttons">
                                <h:commandButton id="btn_cfrm"
                                                 class="round confirm-colors material-icons"
                                                 value="send"
                                                 action="#{beanCalculator.calc()}"/>

                                <h:commandButton id="btn_rst"
                                                 class="round reset-colors material-icons"
                                                 value="backspace"
                                                 action="#{beanCalculator.reset()}"/>
                            </div>

                        </div>
                    </h:form>
                    <h:form id="hidden-form">
                        <h:inputHidden id="graph-x" value="#{beanCalculator.x}"/>
                        <h:inputHidden id="graph-y" value="#{beanCalculator.y}"/>
                        <h:inputHidden id="graph-r" value="#{beanCalculator.r}"/>
                        <h:commandButton id="graph-send"
                                         action="#{beanCalculator.calc()}"
                                         style="opacity:0"/>
                    </h:form>
                </div>
                <div style="flex: 1">
                    <h:dataTable id="result"
                                 class="result-table"
                                 var="res"
                                 value="#{beanCalculator.bigList}"
                                 style="width:100%">
                        <h:column>
                            <f:facet name="header">X</f:facet>
                            #{res.x}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Y</f:facet>
                            #{res.y}
                        </h:column>
                        <h:column>
                            <f:facet name="header">R</f:facet>
                            #{res.r}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Входит?</f:facet>
                            #{res.getIsInside() ? "Да" : "Нет"}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Время</f:facet>
                            #{res.timestamp}
                        </h:column>
                        <h:column>
                            <f:facet name="header">Выполнение</f:facet>
                            #{res.executionTime} нс
                        </h:column>
                    </h:dataTable>
                </div>
            </div>
        </div>
        <h:outputScript>
            <ui:fragment rendered="#{beanCalculator.r != null}">
            redrawFigure(#{beanCalculator.r});
            </ui:fragment>

            <ui:fragment rendered="#{beanCalculator.bigList != null and !empty beanCalculator.bigList}">
            var points = [
                <ui:repeat value="#{beanCalculator.bigList}" var="i" varStatus="status">
                {x: #{i.x}, y: #{i.y}, isInside: #{i.isInside}}<ui:fragment rendered="#{!status.last}">,</ui:fragment>
                </ui:repeat>
            ];
            
            points.forEach(function(point) {
                drawDot(point.x, point.y, point.isInside);
            });
            </ui:fragment>

            setTimeout(function() {
            updateRValue();
            }, 100);
        </h:outputScript>
    </h:body>
</f:view>
</html>
